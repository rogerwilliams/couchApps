<!DOCTYPE html>
<html>
  <head>
    <title>My Albums</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
    <link rel="stylesheet" href="style/jquery.mobile-1.0a2.css" type="text/css"/>
  </head>
  <body>
    <div data-role="page">
          <div data-role="header"><h2>Albums</h2></div>
          <div data-role="content">
              <ul id="albums" data-role="listview" data-theme="c" data-dividertheme="b" ></ul>
          </div>
          <div data-role="footer">Footer</div>
      </div>
  </body>
  <script src="vendor/couchapp/loader.js"></script>
  <script type="text/javascript" charset="utf-8">
 
      $db = $.couch.db("albums");
 
      function handleDocumentReady()
      {
          refreshAlbums();
      }
 
      function refreshAlbums()
      {
          $("#albums").empty();
          $db.view("albums/albums",
            { reduce:false,
        	  	success: function( data ) {
                    var i;
                    var album;
                    var artist;
                    var title;
                    var description;
                    var listItem;
                    var externalPage;
                    for( i in data.rows )
                    {
                        album = data.rows[i].value;
                        artist = album.artist;
                        title = album.title;
                        description = album.description;
                        externalPage = "_show/album/" + album._id;
                        listItem = "<li class=\"album\">" +
                                            "<a href=\"" + externalPage + "\">" +
                                                "<h2 class=\"artist\">" + artist + "<\/h2>" +
                                            "<\/a>" +
                                            "<p class=\"title\">" + title + "<\/p>" +
                                            "<p class=\"description\">" + description + "<\/p>";
                                        "<\/li>";
                        $("#albums").append( listItem );
                    }
                    $("#albums").listview( "refresh" );
                }
            });
      }
 
      $(document).ready( handleDocumentReady );
 
  </script>
</html>

